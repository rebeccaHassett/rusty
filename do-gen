#!/bin/sh -x

impl=osss-ucx

inc_dir="`pkg-config --variable includedir $impl`"
flags="`pkg-config --cflags-only-I $impl`"

hdr="$inc_dir/shmem.h"

bindgen                                           \
    --no-doc-comments                             \
    --enable-function-attribute-detection         \
    --allowlist-var '^SHMEM_.*'                   \
    --allowlist-type '^shmem_.*'                   \
    --allowlist-var '^_SHMEM_.*'                  \
    --allowlist-function '^sh.*'                  \
    --constified-enum '.*' --no-prepend-enum-name \
    --translate-enum-integer-types \
    --raw-line '#![allow(non_camel_case_types,improper_ctypes)] // not our fault' \
    -o shmemlib/src/lib.rs \
    $hdr                                          \
    -- \
    $flags

# rm -f $tmpc $tmph




exit

